<?xml version="1.0"?>
<launch>
	<arg name="geotiff_map_file_path" default="$(find hector_geotiff)/maps"/>
	<arg name="start_robot" default="true"/>
	<arg name="teleop_keyboard" default="false"/>
	<arg name="start_rs_ros" default="true"/>
	<arg name="start_joy_node" default="false"/>
	<arg name="publish_master_clock" default="true"/>

	<!-- bring up rviz? -->
	<arg name="rviz" default="false" doc="whether to show Rviz" />
	<include file="$(find home_robot_hw)/launch/master_clock.launch" if="$(arg publish_master_clock)"/>

	<!-- STRETCH DRIVER -->
	<param name="/stretch_driver/broadcast_odom_tf" type="bool" value="false"/>
	<param name="/stretch_driver/fail_out_of_range_goal" type="bool" value="false"/>
  	<param name="/stretch_driver/mode" type="string" value="navigation" />
	<include file="$(find stretch_core)/launch/stretch_driver.launch"
		pass_all_args="true"
		if="$(arg start_robot)"/>
	<!-- -->

	<!-- Realsense driver -->
	<include file="$(find realsense2_camera)/launch/rs_aligned_depth.launch" if="$(arg start_rs_ros)">
		<arg name="camera" value="camera"/>
		<arg name="align_depth" value="true"/>
		<arg name="filters" value="decimation,disparity,spatial,temporal,pointcloud"/>
	</include>

	<!-- LASER RANGE FINDER -->
	<include file="$(find home_robot_hw)/launch/rplidar.launch" />
	<!-- -->

	<!-- LASER SCAN MATCHER FOR ODOMETRY -->
	<!--include file="$(find stretch_core)/launch/stretch_scan_matcher.launch" /-->
	<!-- -->

	<!-- Rviz visualization -->
	<include file="$(find home_robot_hw)/launch/visualization.launch" if="$(arg rviz)" />

	<!-- launch the main mapping node -->
	<include file="$(find home_robot_hw)/launch/stretch_hector_mapping.launch">
		<arg name="pub_map_odom_transform" value="false"/>
	</include>

	<include file="$(find hector_geotiff_launch)/launch/geotiff_mapper.launch">
		<arg name="trajectory_source_frame_name" value="scanmatcher_frame"/>
		<arg name="map_file_path" value="$(arg geotiff_map_file_path)"/>
	</include>

	<!-- Keyboard teleop, if we need it -->
	<include file="$(find stretch_core)/launch/teleop_twist.launch" if="$(arg teleop_keyboard)">
		<arg name="teleop_type" value="keyboard"/>
	</include>

	<include file="$(find home_robot_hw)/launch/controller.launch" if="$(arg start_joy_node)"/>
	<include file="$(find home_robot_hw)/launch/home_robot_nodes.launch"/>

	<!-- Manipulation from FUNMAP -->
	<!-- set this to true to start experimental funmap grasp/place code-->
	<arg name="start_funmap" default="false"/>
	<group if="$(arg start_funmap)">
		<node name="funmap_grasping" pkg="stretch_demos" type="grasp_point" output="screen" />
		<node name="funmap_placing" pkg="stretch_demos" type="place_point" output="screen" />
	</group>

</launch>
